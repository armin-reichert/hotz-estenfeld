\section{The finite automaton, regular sets in $X^*$,\ $\reglang(X^*)$}

Let $G = (V, E)$ be a finite, oriented graph, $X$ a finite set and $\alpha =
(\pathcat{G}, X^*,\alpha_1, \alpha_2)$ a functor with $\alpha_1 : V \to
\setof{X^*},\ \alpha_2 : \pathcat{G} \to X^*$.

\begin{definition}
$\fa{A} = (G, X^*, \alpha)$ is called a {\bf nondeterministic finite
automaton}.
\end{definition}

\transrem{Here the free monoid $X^*$ is regarded as a category
$X^* = (\setof{X^*}, X^*, Q, Z, \cdot \})$ where $\cdot$ is the monoid
operation (word concatenation). Words are treated as morphisms with source and target
$X^*$.}

If $S, F \subset V$, we call 
\[ \fa{A} = (G, X^*, s, f, \alpha) \]
a finite automaton with start and final states or shortly a {\bf finite
acceptor}.

In the following we will use the terms {\em acceptor} and {\em finite automaton}
as synonyms.

If the finite automaton works over the free monoid $X^*$ we write shorter just
$X$ instead of $X^*$, otherwise we specify the monoid explicitly.

If we define 
\[ \pathcat{G}(S, F) := \setof{\pi \in \pathcat{G} \mid Q(\pi) \in S,\ Z(\pi)
\in F}
\] 
then $L_{\fa{A}} := \alpha_2(\pathcat{G}(S, F))$ is called the {\bf set accepted
by} \fa{A}.

We will also write shortly $\alpha$ instead of $\alpha_2$ and $\pathcat{}(S,F)$
instead of $\pathcat{G}(S,F)$.

\begin{definition}
Let $X$ be an alphabet. 
\[ \reglang(X^*) := \setof{L \subset X^* \mid \mbox{ there exists a finite acceptor
}\fa{A} \mbox{ with } L = L_{\fa{A}}} \]

$\reglang(X^*)$ is called the {\bf set of regular languages} over the free monoid
$X^*$.
\end{definition}

Remark: We defined the finite automaton via its ''state graph''. Most
often, the definition is given using the ''next state relation'' as follows:
\begin{eqnarray*}
\delta &=& \{(a, v_1, v_2) \in X \times V \times V) \mid \\
&& \mbox{there exists an edge } e \mbox{ with } Q(e) = v_1,\ Z(e) = v_2 \mbox{
and } \alpha(e) = a \in X \}
\end{eqnarray*}

$\delta$ my be regarded as a relation between $X \times V$ and $V$ where $X$ is
the input alphabet and $V$ the state set of the automaton \[ \fa{B} = (X,
V, \delta, S, F) \]

The elements of $V$ denote the current state of the automaton $\fa{B}$.

If the automaton $\fa{B}$ is in state $v \in V$ and reads the symbol $x
\in X$ then it changes into state $v' \in V$ where $(x, v, v') \in \delta$. If
there doesn't exist such a $v'$ the automaton halts.

This interpretation can be visualized as follows:

\missingfigure

Let's return to our definition of the finite automaton. We explain its
working based on our definition:

The automaton $\fa{A} = (G, X, S, F, \alpha)$ may be interpreted as a
nondeterministic algorithm. The points (vertices) of the graph $G$ define the
possible states of the algorithm, the elements of $X$ are the input alphabet.

The nondeterministic automaton $\fa{A}$ which reads a symbol $x \in X$
while in state $v \in V$ changes into state $v'$ if there exists an edge $e$
from $v$ to $v'$ with label $\alpha(e) = x$. If the graph has no such edge
originating in $v$ the automaton is set ''out of service''.

A finite acceptor accepts a word $w \in X^*$ if there exists a path from a point
in $S$ to a point in $F$ which is labelled with the word $w$.

Let's consider some examples for finite automata:

\begin{example}
Let $X = \setof{a, b}$ and $L = \setof{(a b)^{2n} \mid n \in
\mathbb{N}}$.

It holds: $L \in \reglang(\setof{a, b}^*)$.

The acceptor $\fa{A} = (G, \setof{a, b}, {1}, {1}, \alpha)$ accepts $L$
(exercise):
\begin{center}
\input{figures/chapter2-1-example1.tikz}
\end{center}
\end{example}

\bigskip
Example 2: Lexical analysis, check for special characters.

In every programming language there exist special character combinations
(reserved words) that mark certain program actions. These have to be identified
during the lexical analysis. We give a finite acceptor which realizes such a check for a selection
of reserved words:

Let the set of reserved words be 
\begin{center}
\{\,'BEGIN',\ 'END',\ 'ELSE',\ 'IF',\ FI',\ 'FOR',\ 'INTEGER',\ 'THEN',\
'LOOP',\ 'POOL',\ 'PROCEDURE'\,\}
\end{center}

The following acceptor accepts this set:

\begin{minipage}{\textwidth}
\begin{sideways}
\input{figures/chapter2-1-example2.tikz}
\end{sideways}
\end{minipage}

The images of the edges under the mapping $\alpha$ are shown as edge labels. The
points of the graph are the ovals with their labels. Start and final states are
given by $S = \{$ START $\}$ and $F = \{$ STOP $\}$.

The labels at the vertices are chosen such that one can see the information
stored by the automaton.

Now we want to prove some properties of $\reglang(X^*)$. To do that, we need
some basic properties for finite automata.

\begin{lemma}
Let $\fa{A} = (G, X, S, F, \alpha)$ be a finite automaton. Then there
exists a finite automaton $\fa{A'} = (G', X, S', F', \alpha')$ such that
$\card{S'} = \card{F'} = 1$ and $\lang{A} = \lang{A'}$.
\end{lemma}

An automaton with a single start state is called {\bf initial}.

\begin{proof}
If $\card{S} = \card{F} = 1$ we are done.

\transrem{The proof in the original book was rather unreadable
because of all these tildes, primes, indices etc. Therefore it has been
reformulated.}

Let $\card{S} > 1$ or $\card{F} > 1$.

1. Add new edges leaving the new start state $S'$:

Define the set of all edges leaving an old start state by
\[ OUT := \setof{e \in E \mid Q(e) \in S} \]
Add the following new edges to the graph:
\[ OUT' := \setof{e' = (S', Z(e)) \mid e \in OUT,\ \alpha'(e') := \alpha(e)} \]

2. Add new edges reaching the new final state $F'$:

Define the set of all edges reaching an old final state by
\[ IN := \setof{e \in E \mid Z(e) \in F} \]
Add the following new edges to the graph:
\[ IN' := \setof{e' = (Q(e), F') \mid e \in IN,\ \alpha'(e') := \alpha(e)} \]

To each new edge we assign the same label as the edge from which it has been
derived.

The new automaton $\fa{A'} = (G', X, \setof{S'}, \setof{F'}, \alpha')$ is
defined by the graph $G' = (V \cup \setof{S', F'}, E \cup OUT' \cup IN')$
and the new labeling $\alpha'$ which is identical to $\alpha$ for all existing 
edges and is defined as shown above for the new edges.

It is easily shown that $\lang{A'} = \lang{A}$.
\end{proof}

\begin{lemma}
Let $\fa{A} = (G, X, S, F, \alpha)$ be a finite automaton. Then there
exists an automaton $\fa{A'} = (G', X, S', F', \alpha')$ with $\alpha'(e)
\in X\ \forall e \in E(G)$ and $\lang{A} = \lang{A'}$.
\end{lemma}

\begin{proof}
We ''split'' all edges according to their labels.

\begin{enumerate}
  \item Let $e \in E$ with $\alpha_2(e) = x_1 \cdots x_k,\ k > 1, x_i \in X$.\\
  Remove edge $e$ and add new edges $e'_1,
  \ldots, e'_k$ and new points $P'_1, \ldots, P'_{k-1}$ such that $(Q(e),
  e'_1, \ldots, e'_k, Z(e)) \in \pathcat{G'}$ and define a new graph $G' =
  (V', E')$. The labeling of the new edges is defined by $\alpha'(e'_i) := x_i$
  for $i = 1, \ldots, k$.
  
  Then $\alpha_2(e) = \alpha'_2(e'_1) \cdots \alpha'_2(e'_k)$.
  
  \item Let $e \in E$ be an edge labeled with $\epsilon$.
  \begin{enumerate}
    \item  (Remove $\epsilon$-loops) \\
    If $Q(e) = Z(e) : E' := E - e$
    \item (Remove
    $\epsilon$-edges which cannot be continued to a longer path)\\
    If there is
    not $e' \in E$ with $Q(e') = Z(e') : E' := E - e$
    \item  (Skip $\epsilon$-edges that can be continued and remove the
    $\epsilon$-edge)\\
    If there exists an edge $e' \in E$ with $Q(e') = Z(e) : E'' := E - e$.
    Add new edges: $E' := E'' \cup \setof{\tilde{e} \mid Q(\tilde{e}) = Q(e), 
    Z(\tilde{e}) = Z(e'),\ alpha'(\tilde{e}) := \alpha(e')}$
  \end{enumerate}
  If in step (b) or (c) the target of the edge is a final state, then add the
  source of the edge to the set of final states.
  
  Continue this algorithm inductively until no more $\epsilon$-edges remain in
  the graph. The algorithm terminates because the point and edge sets are
  finite. For the new automaton $\fa{A'}$ that results from this algorithm
  holds: $\lang{A'} = \lang{A}$.
\end{enumerate}
\end{proof}

If we apply this algorithm to our automaton from example 1, we obtain:

\missingfigure

Now we want to prove some closure properties of $\reglang(X^*)$.

\begin{theorem}[Regular languages are closed under union and intersection]
\[ L, L' \in \reglang(X^*) \Rightarrow L \cup L' \in \reglang(X^*) \wedge L \cap L' \in
\reglang(X^*) \]
\end{theorem}

\begin{proof}
Let $L = \lang{A}$ and $L' = \lang{B}$ with automata \[
\fa{A} = (G_A, X, S_A, F_A, \alpha) \] and \[ \fa{B} = (G_B, X, S_B,
F_B, \beta).\]
We may assume that the edge and point sets of both automata graphs are disjoint.

\begin{enumerate}
  \item Closure under union: Define
	\[ \gamma_2(e) := \left\{
		\begin{array}{l} 
		\alpha_2(e),\ e \in E(G_A) \\
		\beta_2(e),\ e \in E(G_B)
		\end{array}
	 \right. \]

	Then the automaton $\fa{C} = (G_A \cup G_B, X, S_A \cup S_B, F_A \cup
	F_B, \gamma)$ accepts the language $\lang{A} \cup \lang{B}$.
	
	\item Closure under intersection: Define $G' = (V', E')$ where
	\[ V' = V_A \times V_B \]
	\[ E' = \setof{(e_A, e_B) \in E_A \times E_B \mid \alpha_2(e_A) = \beta_2(e_B)}
	. \]
	By lemma 2 we may assume that the edge labels are all single symbols from $X$.
	
	We define the new labelling $\delta_2$ by \[ \delta_2 : E' \to X,\
	\delta_2((e_A, e_B) = \alpha_2(e_A)). \]
	
	For the automaton $\fa{A'} = (G', X, S_A \times S_B, F_A \times F_B,
	\delta)$ then holds: $\lang{G'} = \lang{A} \cap \lang{B}$
	and this automaton is called the {\bf cartesian product} of $\fa{A}$ and
	$\fa{B}$.
\end{enumerate}
\end{proof}

\bigskip
\begin{theorem}[Regular languages are closed under mirror operation]
\[ L \in \reglang(X^*) \Rightarrow L^R \in \reglang(X^*) \]
\end{theorem}

\begin{proof}
Let $\fa{A} = (G, X, S_{\fa{A}}, F_{\fa{A}}, \alpha)$ be a
finite acceptor for $L$.

Create the graph $G' = (V(G), E')$ where $E'$ is a set with the same cardinality
as $E$. There exists a bijection from $E$ to $E'$ mapping edges as follows:
\[ e : P \to P' \in E \Leftrightarrow e' : P' \to P \in E' \]
which means we reverse the orientation of the edges.

For the resulting automaton $\fa{A'} = (G', X, S_{\fa{A}},
F_{\fa{A}}, \alpha')$ with $\alpha'(e') = \alpha(e)$ for all edges of $G'$
it holds: $\lang{A'} = \lang{A}^R = L^R \in \reglang(X^*)$.
\end{proof}

\bigskip
\begin{definition}
Let $\fa{A} = (G, X, S, F, \alpha)$ be a finite automaton with
$\alpha(E(G)) \subset X$ (each edge is labeled with a single
symbol).

$\fa{A}$ is called {\bf deterministic} $\Leftrightarrow$ for all $e, e'
\in E(G)$ with $Q(e) = Q(e')$ and $\alpha(e) = \alpha(e')$ it holds: $e$ = $e'$.

$\fa{A}$ is called {\bf complete} $\Leftrightarrow$ for each $P \in V(G)$
and $x \in X$ there exists an edge $e \in E(G)$ with $Q(e) = P$ and $\alpha(e)
= x$.
\end{definition}

\begin{theorem}[Existence of complete, deterministic acceptor]
If \fa{A} is a finite automaton, then there exists a complete,
deterministic automaton \fa{A'} which accepts the same language.
\end{theorem}

\begin{proof}
From our lemmata we may assume that $\card{S_{\fa{A}}} = 1$ and
$\alpha_2(e) \in X$ for all edges $e$ in the graph of \fa{A}.

We construct an automaton \fa{A'} as follows (''subset construction''):

Instead of the points of the graph $G$ our new graph has the power set
$\powset{V(G)}$ of $V(G)$ as its point set.

For $\tilde{P} \in \powset{V(G)}$ we define 
\begin{eqnarray*}
& N(x, \tilde{P}) := & \{ P \in V(G) \mid \mbox{there exists an edge } e \in
E(G) \mbox{ with } \\
& & \ Q(e) \in \tilde{P}, Z(e) = \tilde{P} \mbox{ and } \alpha(e) = x \} 
\end{eqnarray*}

The empty set $\emptyset$ is also an element of the power set such that it will
also become a point of the new graph.

Let $\tilde{P}, \tilde{R} \in \powset{V(G)}$. These points are connected by an
edge $e$ with label $\alpha'_s(e) = x \Leftrightarrow \tilde{R} = N(x, \tilde{P})$.

This defines our new graph $G' = (V', E')$.

The start and final states are defined as follows:
\[ S_{\fa{A'}} = \setof{S_{\fa{A}}} \]
\[ F_{\fa{A'}} = \setof{\tilde{R} \in \powset{V(G)} \mid \tilde{R} \cap
F_{\fa{A}} \neq \emptyset} \]

This completes the definition of automaton $\fa{A'} = (G', X,
S_{\fa{A'}}, F_{\fa{A'}}, \alpha')$.

We first prove that
\fa{A'} is complete and deterministic:

\fa{A'} has a single start state $S_{\fa{A'}} = \setof{S_{\fa{A}}}$, 
the edge labels are all single symbols and 
\[ \card{\setof{e \in E' \mid Q(e) = \tilde{P}, \alpha'_2(e) = x}} = 1 \]
for all $\tilde{P} \in V(G')$.

Now we prove that the accepted languages are equal:

''$\subset$'': We use diagrams of the following form:
\begin{eqnarray*}
& P \edge{x} R & \\
& \tilde{P} \edge{x} \tilde{R} &
\end{eqnarray*}

which are to be understood as follows: For $P \edge{x} R \in E(G)$
there exists by construction $\tilde{P} \edge{x} \tilde{R} \in
E(G')$ with $P \in \tilde{P}$ and $R \in \tilde{R}$.

Starting with $S_{\fa{A'}} = \setof{S_{\fa{A}}} = \setof{\setof{P_0 }}$ and
concatenating these diagrams, we get for $x_1 \cdots x_k \in
L_{\fa{A}}$:
\begin{eqnarray*}
 & & P_0 \edge{x_1} P_1 \edge{x_2} P_2 \edge{} \ldots \edge{} P_{k-1} \edge{x_k}
 P_k \in F_{\fa{A}} \\
 & & \tilde{P}_0 \edge{x_1} \tilde{P}_1 \edge{x_2} \tilde{P}_2 \edge{} \ldots
 \edge{} \tilde{P}_{k-1} \edge{x_k} \tilde{P_k}
\end{eqnarray*}

That means $\tilde{P_k} \cap F_{\fa{A}} \neq \emptyset \Rightarrow \tilde{P}_k \
\in F_{\fa{A'}} \Rightarrow w \in \lang{A'}.$

\[ \Rightarrow \lang{A} \subset \lang{A'}\]

''$\supset$'': Here we use diagrams  
\begin{eqnarray*}
& \tilde{P} \edge{x} \tilde{R} & \\
& P \edge{x} R & 
\end{eqnarray*}

which are to be understood as follows: For $\tilde{P} \edge{x} \tilde{R} \in
E(G')$ and $R \in \tilde{R}$ there exists $P \in \tilde{P}$ with $P \edge{x} R
\in E(G)$.

For $x_1 \cdots x_K \in \lang{A'}$ we start with $F_{\fa{A'}}$ and continue
the diagram from right to left. For $P_k \in \tilde{P}_k \cap F_{\fa{A}}$ we get
\begin{eqnarray*}
 & S_{\fa{A'}} \ni & \tilde{P}_0 \edge{x_1} \tilde{P}_1 \edge{x_2} \tilde{P}_2 \edge{} \ldots
 \edge{} \tilde{P}_{k-1} \edge{x_k} \tilde{P_k} \in F_{\fa{A'}} \\
 & & P_0 \edge{x_1} P_1 \edge{x_2} P_2 \edge{} \ldots \edge{}
 P_{k-1} \edge{x_k} P_k \in F_{\fa{A}} 
\end{eqnarray*}

Because of $S_{\fa{A'}} = \setof{S_{\fa{A}}} = \setof{\setof{P_0}}$ it holds:
$x_1 \cdots x_k \in \lang{A} \Rightarrow \lang{A'} \subset \lang{A}$.

\[ \Rightarrow \lang{A'} \subset \lang{A}\]

From both inclusions we get $\lang{A} = \lang{A'}$.
\end{proof}

\bigskip
Remark: The state set grows exponentially when the automaton is made
deterministic. The following example will clarify this fact \cite{Commentz}.

\bigskip
Example: Let $X = \setof{a, b}$. Define for arbitrary, but fixed $n \in
\mathbb{N}$ \[ L_n := \setof{w \mid w = w_1 \cdot w_2 \mbox{ with } w1 \neq w_2,
|w_1| = |w_2| = n, w_1, w_2 \in X^*} \]

$L_n \in \reglang(X^*)$ because there exists a nondeterministic finite acceptor
$\fa{A}_{n}$ with $L_n = L_{\fa{A}_{n}}$.

We want to give the automaton for $n = 3$:

$\fa{A}_3 = (G_3, \setof{a,b}, \setof{1}, \setof{22}, \alpha)$ with the
following graph $G_3$:

\missingfigure

The labeling $\alpha$ is shown at the edges.

Exercise: Show that this automaton accepts $L_3$.

If we construct for $L_3$ from the nondeterministic acceptor $\fa{A}_3$
the deterministic acceptor $\fa{A'}_3$, the graph $G'_3$ looks as follows:

\missingfigure

The edges pointing upwards are labeled with $a$ and the edges pointing downwards
with $b$.

$G'_3$ is the graph of the complete (up to loops in the final state and state
$\emptyset$), deterministic acceptor $\fa{A'}_3$ and accepts the language $L_3$
(exercise).

In \cite{Commentz} it is proved that this automaton is minimal in the number of
states.

Making a state graph deterministic brings advantages as well as disadvantages. A
program simulating finite automata based on the given state graph is fast for
a deterministic graph. However it needs more space because of the possibly very
large representation of the deterministic graph.

If the program uses the nondeterministic graph, it can follow all alternatives
in parallel similar to our construction of the deterministic automaton. It needs
less memory but the computing time can grow linear for each simulation step.

We want to state an important consequence from our last theorem.

\begin{theorem}[Regular languages are closed under complement]
\[ L \in \reglang(X^*) \Rightarrow \bar{L} = X^* - L \in \reglang(X^*) \]
\end{theorem}

\begin{proof}
$L \in \reglang(X^*) \Rightarrow $ there exists a complete, deterministic
finite acceptor $\fa{A}$ with $\lang{A} = L$.

Define $\fa{A'} = (G, X, S_{\fa{A}}, F_{\fa{A}}, \alpha)$ where $F_{\fa{A}} :=
V(G) - F_{\fa{A}}$.

Because \fa{A} is complete and deterministic, every word $w \in X^*$ determines
a unique path starting in $S_{\fa{A}}$.

This $w \in X^*$ uniquely determines a point $P \in V(G)$ with $w \in
\alpha(\pathcat{W}(S_{\fa{A}}, P))$.

It is either $P \in F_{\fa{A}}$ or $P \in F_{\fa{A'}}$ and from $F_{\fa{A}}
\cap F_{\fa{A}'} = \emptyset$ follows $w \in \lang{A} \Leftrightarrow w
\notin \lang{A'}$ and therefore $\lang{A'} = \bar{\lang{A}}$.
\end{proof}

\bigskip
\begin{theorem}[Regular languages are closed under concatenation]
\[ L_1, L_2 \in \reglang(X^*) \Rightarrow L_1 \cdot L_2 \in \reglang(X^*) \]
\end{theorem}

\begin{proof}
$L_1, L_2 \in \reglang(X^*) \Rightarrow$\ there exist finite acceptors
$\fa{A}_i = (G_i, X, S_i, F_i, \alpha_i)$ with $L_i = \lang{A}_i,\ i = 1,2$.

We define a new acceptor
\[\fa{A} = (G, X, S, F, \alpha) \]
as follows:

Vertices:
\[ V(G) := V(G_{\fa{A}_1}) \cup V(G_{\fa{A}_2})\mbox{ where }V(G_{\fa{A}_1})
\cap V(G_{\fa{A}_2}) = \emptyset \]

Edges:
\[ E(G) = E(G_{\fa{A}_1}) \cup E(G_{\fa{A}_2}) \cup \mbox{ 'bridge'' edges
defined as follows:}
\]

\missingfigure (bridge edge)

Here $R \in F1$ is a final state in $\fa{A}_1$, $x = \alpha_1(e_1)$ is the label
of edge $e_1$, $P'$ is a start state in $\fa{A}_2$.

For each such configuration, a new ''bridge''	edge $e$ is added to $E(G)$ where
\[ Q(e) := P,\ Z(e) := P' \mbox{ and } \alpha(e) := x.\]

Start and final states: $S := S_{\fa{A}_1}$ and $F := F_{\fa{A}_2}$.

We now prove that $\lang{A} = \lang{A}_1 \cdot \lang{A}_2$.

\begin{enumerate}
  \item $\lang{A} \supset \lang{A}_1 \cdot \lang{A}_2$
  
  Let $u = u_1 \cdots u_n \in \lang{A}_1$ and $v = v_1 \cdots v_m \in
  \lang{A}_2$. Then there exist accepting paths
  \[ S_1 \ni P_0 \edge{u_1} P_1 \edge{u_2} \ldots \edge{u_n} P_n \in F_1 \]
  and 
  \[ S_2 \ni Q_0 \edge{v_1} Q_1 \edge{v_2} \ldots \edge{v_m} Q_m \in F_2 \]
  
  By construction of graph $G$ there exists a path in $\pathcat{G}(S1, F2)$ of
  the form
  \[ S_1 \ni P_0 \edge{u_1} P_1 \edge{u_2} \ldots P_{n-1} \edge{u_n} Q_0
  \edge{v_1} Q_1 \edge{v_2} \ldots \edge{v_m} Q_m \in F_2 \]
  
  It follows $u = u_1 \cdots u_n \cdot v_1 \cdots v_m \in \lang{A}$ thus
  $\lang{A}_1 \cdot \lang{A}_2 \subset \lang{A}$.
  
  \item $\lang{A} \subset \lang{A}_1 \cdot \lang{A}_2$
  
  Let \[ S \ni P_0 \edge{w_1} P_1 \edge{w_2} \ldots \edge{w_n} P_n \in F \] be
  an accepting path in $\pathcat{G}(S, F)$. Then there exist states $P_i \in
  S_2$ and $P_j \in V(G_1)$ with $j < i$ because $V(G_1) \cap V(G_2) =
  \emptyset$.
  
  \missingfigure
  
  Therefore the subpath \[ S_2 \ni P_i \edge{w_{i+1}} P_{i+1} \edge{} \ldots
  \edge{w_n} P_n \in F_2 \] contains only edges and vertices from $\fa{A}_2$ and
  is an accepting path for the word $w_{i+1} \cdots w_n \in \lang{A}_2$.
  
  It holds $P_{i-1} \in V_1$ and by construction of the graph $G$ there exists
  an edge labeled with $w_i$ which ends in a final state of $\fa{A}_1$. So $w_1
  \cdots w_i \in \lang{A}_1$.
  
  Together we get \[ w_1 \cdots w_i \cdots w_n \in \lang{A}_1 \cdot
  \lang{A}_2 \Rightarrow \lang{A} \subset \lang{A}_1 \cdot \lang{A}_2.\]
\end{enumerate}

From (1) and (2) it follows $\lang{A} = \lang{A}_1 \cdot
\lang{A}_2$.
\end{proof}

\bigskip
\begin{theorem}[Regular languages are closed under Kleene-star]
\[ L \in \reglang(X^*) \Rightarrow L^* \in \reglang(X^*) \]
\end{theorem}

\begin{proof}
\missingfigure (graph construction)

Let $\fa{A} = (G, X, S, F, \alpha)$	be a finite acceptor for $L$, create the
finite acceptor $\fa{A'} = (G', X, S, F, \alpha')$ as follows:

Graph: Take the graph $G$ and add the following edges: 

\begin{enumerate}
  \item For each edge \[e : P \edge{x} R \in E(G),\ R \in F\] leading to a
  final state and each start state $P_0$ add an edge \[e' : P \edge{x} P_0 \]
  labeled by $\alpha'(e') := x$.
  \item For each state $P_0 \in S$ and each final state $R \in F$ add an edge
  (if not already existing) \[ e' : P_0 \edge{\epsilon} R \]
  labeled by $\alpha'(e') := \epsilon$.
\end{enumerate}

For the finite acceptor $\fa{A'}$ it holds (exercise): \[ \lang{A'} = L^* \]
\end{proof}

We have seen (lemma 1) that for nondeterministic automata a single start and a
single final state are sufficient but in the deterministic case a single final
state is in general insufficient.

\bigskip
\begin{theorem}[The regular languages are closed under homomorphism]
\[ L \in \reglang(X^*),\ \phi : X^* \to Y^* \mbox{ monoid homomorphism }
\Rightarrow \]
\[ \phi(L) := \setof{\phi(w) \mid w \in L} \in \reglang(X^*) \]
\end{theorem}
\begin{proof}
Let $\fa{A} = (G, X, S, F, \alpha)$ be a finite acceptor for $L$. Then \[
\fa{B} = (G, Y, S, F, \beta)\] with $\beta_2(e) := \phi(\alpha_2(e)),\ e \in
E(G)$, is an acceptor for $\phi(L)$ because \[\phi(L) =
\phi(\alpha_2(\pathcat{G}(S, F))) = \beta_2(\pathcat{G}(S,F))\]
Therefore \[ \phi(L) \in \reglang(Y^*) \]
\end{proof}

After having proved closure properties, we prove some other important properties
of regular sets.

\begin{lemma}
For $x \in X$ it holds $\setof{x} \in \reglang(X^*)$ and $\emptyset \in \reglang(X^*)$.
\end{lemma}
\begin{proof}
If $G = (\setof{S,F}, \setof{e}),\ e: S \to F$ be a graph, then the finite
acceptor \[\fa{A}_x = (G, \setof{x}, \setof{S}, \setof{F}, \alpha)\] with $\alpha_2(e) =
x$ fulfills $\lang{A} = \setof{x}$.

If $G = (\setof{S,F}, \emptyset)$, then $\fa{A} = (G, \emptyset, \setof{S},
\setof{F}, \emptyset)$ fulfills $\lang{A} = \emptyset$.
\end{proof}

\bigskip
\begin{lemma}[The set of accepting paths is regular]
Let $G = (V, E)$. Then \[ \pathcat{G}(S,F) \in \reglang(E^*) \]
\end{lemma}
This means that the paths in a graph leading from a start state to a final state
form a regular set over the free monoid of edge sequences. 
\begin{proof}
The proof is trivial, just label each edges with itself.
\end{proof}

\bigskip
\begin{definition}
$L \subset X^*$ is called {\bf local over $X$} if there exist subsets $S,\ F
\subset X$ and a relation $R \subset X \times X$ with 
\[ L = \setof{x_1 \cdots x_k \mid x_1 \in S,\ x_k \in F,\ (x_i, x_{i+1}) \in R,
\quad i = 1, \ldots, k - 1} \]
\end{definition}

\bigskip
\begin{lemma}[The set of accepting paths is local]
Let $G = (V, E)$ be a graph. Then $\pathcat{G}(S, F)$ is local over $E$.
\end{lemma}

\begin{proof}
Let \begin{eqnarray*}
S & = & \setof{e \in E \mid Q(e) \in S} \\ 
F & = & \setof{e \in E \mid Z(e) \in F} \\
R & = & \setof{(e, e') \in E \times E \mid Z(e) = Q(e')} 
\end{eqnarray*}
Then the claim is immediately proved.
\end{proof}

\bigskip
\begin{lemma}[Every local set is regular]
\[ L \mbox{ local over } X \Rightarrow L \in \reglang(X^*) \]
\end{lemma}

\begin{proof}
Let $S$ and $F$ be the subsets of $X$ from the definition of a local
set. Define a graph $G = (V, E)$ as follows:
\begin{eqnarray*}
V & = & X \cup \setof{\bar{S}} \mbox{ with } X \cap \setof{\bar{S}} = \emptyset
\\
E & = & \setof{e : \setof{\bar{S}} \to x \mid x \in S} \cup \setof{e : x \to y
\mid (x, y) \in R}
\end{eqnarray*}

Consider the finite acceptor $\fa{A} = (G, X, \setof{\bar{X}}, F, \alpha)$ with
labeling $\alpha$ defined by $\alpha_2(e) = Z(e)$ for each edge $e \in E$.

Then it is clear that $\lang{A} = L$.
\end{proof}

\bigskip
\begin{lemma}[Every regular set is the homomorphic image of a local set]
Let $L \in \reglang(X^*)$ be a regular set. Then there exists a local set
$R$ over $X$ and a monoid homomorphism $\phi$ such that \[ \phi(R) = L \]
\end{lemma}

\begin{proof}
Exercise.
\end{proof}

\bigskip
We want to summarize our results to some main theorems where we organize these
results differently.

Let $X_\infty = \setof{x_1, x_2, \ldots}$ be an infinite alphabet. Define 
\[ \reglang(X_\infty^*) = \bigcup_{X \subset X_\infty} \reglang(X^*),\ X
	\text{ is finite} \]

\bigskip
\begin{maintheorem}\ 

\begin{enumerate}
  \item $\reglang(X_\infty^*)$ is closed under union, complex product and
  star-operation.
  \item If $\phi : X_\infty^* \to X_\infty^*$ is a monoid homomorphism, then
$\reglang(X_\infty^*)$ is closed under $\phi$.
	\item Every $L \in \reglang(X_\infty^*)$ is the homomorphic image of a local set
	over $X_\infty^*$.
	\item $\reglang(X_\infty^*)$	 contains the sets $\setof{x}, x \in X_\infty^*$ and
	the empty set $\emptyset$.
\end{enumerate}
\end{maintheorem}

\bigskip
\begin{maintheorem}\ 

\begin{enumerate}
  \item $\reglang(X_\infty^*)$ is a Boolean Algebra with operations union, 
  intersection and complement. 
	\item Every language $L \in \reglang(X_\infty^*)$ is accepted by some complete,
deterministic automaton.
\end{enumerate}
\end{maintheorem}

To prove the first main theorem we don't need the fact that $X^*$ is a {\bf
free} monoid. In the proof of main theorem 2 we used that fact.

There exist monoids $M$ for which the second main theorem does not
hold for $\reglang(M)$, in both sentences (see exercises).

Of special interest are the monoids $M = F(X)$, where $F(X)$ is the free group
generated by $X$ (see chapter 1.3) and $M = X^\oplus$ where $X^\oplus$ is the
free commutative group generated by $X$.

Languages $L \in \reglang(X^\oplus)$ are also called {\bf semi-linear}.

Exercices:
\begin{enumerate}
  \item Let $\phi : (\setof{x, y}^*, \cdot) \to (\mathbb{Z} / 3 \mathbb{Z}
  \times \mathbb{Z} / 4 \mathbb{Z}, +)$ be given by $\phi(x) = (0,1), \phi(y) = (1,0)$.
  
  Construct a finite automaton \fa{A} with $\lang{A} = \phi^{-1}((0,0))$ and
  present $\phi^{-1}((0,0))$ as a rational set.
  
  \item Let $\fa{A} = (G, X, S, F, \alpha)$ be a finite automaton with $n$
  states. Prove:
  \begin{enumerate}
    \item If $x \in \lang{A}$ with $|x| >= n$, then there exists words $u, v
    w \in X^*$ with $x = u \cdot v \cdot w, v \neq \epsilon$ and $u \cdot v^m
    \cdot w \in falang{A}\ \forall m \geq 1$ (''pumping lemma'').
    \item \lang{A} infinite $\Leftrightarrow \exists x \in X^*$ with $n \leq
    |x| \leq 2n$ and $x \in \lang{A}$.
   \end {enumerate}

	\item Show: The set $L = \setof{a^n b^n} \mid n \in \mathbb{N}$ is not
	regular.
	
	\item Let $L \in \reglang(X^*), M \subset X^*$ finite. Show: $M^{-1}L \in \reglang(X^*)$.
	What if $M \subset \reglang(X^*)$ is an arbitrary regular set?
\end{enumerate}

